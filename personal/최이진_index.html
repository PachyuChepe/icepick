<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>아이스픽</title>
    <!-- 필요한 외부 라이브러리 및 스타일 시트 가져오기 -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <!-- 스크립트 및 스타일 시트 파일 링크 -->
    <!-- <script defer src="script/chat.js"></script> -->
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/slide.css" />
    <link rel="stylesheet" href="../css/character.css" />
    <link rel="stylesheet" href="../css/modal.css" />

<style>
  /* 모달창 css실험창 */
  .modalText01 {
 background-color: rgba(255, 255, 255, 0.2);
}


 .modalcharacterimgChart {
  background-color: rgba(255, 255, 255, 0.2);
  align : center;
  width: 450px;
  height: 220px;
  padding-left: 50px;
}

.modalbuttons {
  padding-left: 70px;
}

.col{
  cursor: pointer;
}

</style>

  </head>

  <body>
    <!-- 헤더 섹션 -->
    <header class="p-3 text-bg-dark">
      <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
          <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
            <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap">
              <use xlink:href="#bootstrap"></use>
            </svg>
          </a>

          <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
            <li>
              <a href="#" class="nav-link px-2 text-secondary"
                ><img
                  src="https://blog.kakaocdn.net/dn/nPHIX/btswbChyDep/Id9lRpNNLWqQXr9vGiWgR1/img.gif"
                  style="width: 20px; height: 20px"
                  alt="My Image"
              /></a>
            </li>
            <li><a href="#" class="nav-link px-2 text-white">비익조</a></li>
          </ul>

          <div class="text-end">
            <button type="button" class="btn custom-button" id="modalOpenButton">팀 가입</button>

            <!-- 팀 가입 모달 컨테이너 -->
            <div id="modalContainer" class="hidden">
              <div id="modalContent">
                <div class="modal-header">
                  <h2><span class="close" id="modalCloseButton">&times;</span></h2>
                  <h3 id="signin">비익조 팀원 등록</h3>
                </div>
                <div class="mypostingbox" id="postingbox">
                  <!-- 팀 가입 양식 -->
                  <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="image" placeholder="캐릭터 이미지 주소" />
                    <label for="floatingInput">캐릭터 이미지 주소</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="mname" placeholder="이름" />
                    <label for="floatingInput">이름</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="lv" placeholder="레벨(나이)" />
                    <label for="floatingInput">레벨(나이)</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="dono" placeholder="도감번호" />
                    <label for="floatingInput">도감번호(생년월일)</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="skills" placeholder="배운 기술" />
                    <label for="floatingInput">배운 기술</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="mbti" placeholder="MBTI" />
                    <label for="floatingInput">MBTI</label>
                  </div>

                  <div class="form-floating mb-3" style="display: inline-block">
                    <input type="email" class="form-control" id="mbti_e" placeholder="E 수치" /><label
                      for="floatingInput"
                      >외향형 E 수치</label
                    >
                  </div>
                  <div class="form-floating mb-3" style="display: inline-block">
                    <input type="email" class="form-control" id="mbti_i" placeholder="I 수치" /><label
                      for="floatingInput"
                      >내향형 I 수치</label
                    >
                  </div>
                  <div class="form-floating mb-3" style="display: inline-block">
                    <input type="email" class="form-control" id="mbti_s" placeholder="S 수치" /><label
                      for="floatingInput"
                      >감각형 S 수치</label
                    >
                  </div>
                  <div class="form-floating mb-3" style="display: inline-block">
                    <input type="email" class="form-control" id="mbti_n" placeholder="N 수치" /><label
                      for="floatingInput"
                      >직관형 N 수치</label
                    >
                  </div>
                  <div class="form-floating mb-3" style="display: inline-block">
                    <input type="email" class="form-control" id="mbti_t" placeholder="T 수치" /><label
                      for="floatingInput"
                      >사고형 T 수치</label
                    >
                  </div>
                  <div class="form-floating mb-3" style="display: inline-block">
                    <input type="email" class="form-control" id="mbti_f" placeholder="F 수치" /><label
                      for="floatingInput"
                      >감정형 F 수치</label
                    >
                  </div>
                  <div class="form-floating mb-3" style="display: inline-block">
                    <input type="email" class="form-control" id="mbti_j" placeholder="J 수치" /><label
                      for="floatingInput"
                      >판단형 J 수치</label
                    >
                  </div>
                  <div class="form-floating mb-3" style="display: inline-block">
                    <input type="email" class="form-control" id="mbti_p" placeholder="P 수치" /><label
                      for="floatingInput"
                      >인식형 P 수치</label
                    >
                  </div>

                  <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="comment" placeholder="comment" />
                    <label for="floatingInput">한마디</label>
                  </div>

                  <button type="button" class="btn btn-danger" id="postingbtn">기록하기</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- 이미지 슬라이더 섹션 -->
    <div class="showstart">
      <div class="slideshow-container">
        <div class="slideshow">
          <!-- 이미지 슬라이더 내용 -->
          <img
            src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbhsMI9%2FbtswPVmDhHB%2FvP9B7TR1ewiSSnCRj4S4K0%2Fimg.jpg"
            alt="Image 1"
          />
          <img
            src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbgS8rs%2Fbtsw0iIWDcO%2Fm90kWI4HWk8WoHNLRECaXK%2Fimg.jpg"
            alt="Image 2"
          />
          <img
            src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbfon4p%2FbtswJDf4a7a%2Ftb83tAdaKXQ8jXeD3FQW11%2Fimg.jpg"
            alt="Image 3"
          />
          <img
            src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FnqT97%2Fbtsw0gLf4Tb%2FId80J8BLDB61jCkEtxLd0k%2Fimg.jpg"
            alt="Image 4"
          />
          <img
            src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FyGs1I%2Fbtsxd3jz8fQ%2FJSBuuHz6dKFJRZpNkSPjUk%2Fimg.jpg"
            alt="Image 5"
          />
        </div>
      </div>
      <span class="slideshow-arrow prev" onclick="plusSlides(-1)">&#10094;</span>
      <span class="slideshow-arrow next" onclick="plusSlides(1)">&#10095;</span>
    </div>

    <!-- 카드 섹션 -->
    <div class="mycards">
      <div id="card" class="row row-cols-1 row-cols-md-6 g-6"></div>
    </div>

    <!-- 메인 컨텐츠 -->
    <div class="main"></div>

    <!-- Firebase와 관련된 스크립트 모듈 -->
    <script type="module">
      // Firebase SDK 라이브러리 가져오기
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      // Firebase 구성 정보
      const firebaseConfig = {
        apiKey: "AIzaSyAqgZTkIOU1FDJxLH8CZbBEtt4wA6UK0a0",
        authDomain: "sparta-Aleejin.firebaseapp.com",
        projectId: "sparta-leejin",
        storageBucket: "sparta-leejin.appspot.com",
        messagingSenderId: "44861350306",
        appId: "1:44861350306:web:3294770f6384aed70ed2fb",
        measurementId: "G-EWJVC04VRL",
      };

      // Firebase 인스턴스 초기화
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // 등록 버튼 클릭 이벤트 핸들러
      $("#postingbtn").click(async function () {
        // 입력 필드 값 가져오기
        let image = $("#image").val();
        let mname = $("#mname").val();
        let lv = $("#lv").val();
        let dono = $("#dono").val();
        let skills = $("#skills").val();
        let mbti = $("#mbti").val();
        // 추가된 MBTI 세부 수치
        let mbti_i = $("#mbti_i").val();
        let mbti_e = $("#mbti_e").val();
        let mbti_s = $("#mbti_s").val();
        let mbti_n = $("#mbti_n").val();
        let mbti_t = $("#mbti_t").val();
        let mbti_f = $("#mbti_f").val();
        let mbti_j = $("#mbti_j").val();
        let mbti_p = $("#mbti_p").val();
        let comment = $("#comment").val();

        // 문서 객체 생성
        let doc = {
          image: image,
          mname: mname,
          lv: lv,
          dono: dono,
          skills: skills,
          mbti: mbti,
          mbti_i: mbti_i,
          mbti_e: mbti_e,
          mbti_s: mbti_s,
          mbti_n: mbti_n,
          mbti_t: mbti_t,
          mbti_f: mbti_f,
          mbti_j: mbti_j,
          mbti_p: mbti_p,
          comment: comment,
        };
        // Firestore에 문서 추가
        await addDoc(collection(db, "mambers"), doc);

        // 알림 메시지 표시
        alert("저장 완료!");
        window.location.reload();
      });

      // Firebase에서 데이터 가져오기
      let docs = await getDocs(collection(db, "mambers"));
      docs.forEach((doc) => {
        let row = doc.data();

        // 데이터 추출
        let image = row["image"];
        let mname = row["mname"];
        let lv = row["lv"];
        let dono = row["dono"];
        let skills = row["skills"];
        let mbti = row["mbti"];
        let comment = row["comment"];
        let mbti_i = row["mbti_i"];
        let mbti_e = row["mbti_e"];
        let mbti_s = row["mbti_s"];
        let mbti_n = row["mbti_n"];
        let mbti_t = row["mbti_t"];
        let mbti_f = row["mbti_f"];
        let mbti_j = row["mbti_j"];
        let mbti_p = row["mbti_p"];

        // 카드 HTML 생성
        let temp_html = `            
            <div class="col">
                <div class="card h-100 bg-transparent border-black text-white text-center">
                    <img src="${image}" class="card-img-top" alt="...">
                        <h5 class="card-title">${mname}</h5>
                        <p class="card-text">${dono}</p>
                        <span class="burrow">
                        <p class="user-lv">${lv}</p>
                        <p class="user-skills">${skills}</p>
                        <p class="user-mbti">${mbti}</p>
                        <p class="user-comment">${comment}</p>
                        <p class="user-mbti-i">${mbti_i}</p>
                        <p class="user-mbti-e">${mbti_e}</p>
                        <p class="user-mbti-s">${mbti_s}</p>
                        <p class="user-mbti-n">${mbti_n}</p>
                        <p class="user-mbti-t">${mbti_t}</p>
                        <p class="user-mbti-f">${mbti_f}</p>
                        <p class="user-mbti-j">${mbti_j}</p>
                        <p class="user-mbti-p">${mbti_p}</p>
                        </span>
                        </div>
                        </div>
                        `;
        // 카드 추가
        $("#card").append(temp_html);
      });

      // 카드 이미지 클릭 시 모달 열기 이벤트
      $(document).on("click", ".card-img-top", function () {
        // 클릭한 이미지의 데이터 가져오기
        const imageSrc = $(this).attr("src");
        const cardTitle = $(this).siblings(".card-title").text();
        const cardText = $(this).siblings(".card-text").text();
        const userLv = $(this).closest(".card").find(".user-lv").text();
        const userSkills = $(this).closest(".card").find(".user-skills").text();
        const userMbti = $(this).closest(".card").find(".user-mbti").text();
        const userComment = $(this).closest(".card").find(".user-comment").text();
        const mbtiI = parseInt($(this).closest(".card").find(".user-mbti-i").text(), 10);
        const mbtiE = parseInt($(this).closest(".card").find(".user-mbti-e").text(), 10);
        const mbtiS = parseInt($(this).closest(".card").find(".user-mbti-s").text(), 10);
        const mbtiN = parseInt($(this).closest(".card").find(".user-mbti-n").text(), 10);
        const mbtiT = parseInt($(this).closest(".card").find(".user-mbti-t").text(), 10);
        const mbtiF = parseInt($(this).closest(".card").find(".user-mbti-f").text(), 10);
        const mbtiJ = parseInt($(this).closest(".card").find(".user-mbti-j").text(), 10);
        const mbtiP = parseInt($(this).closest(".card").find(".user-mbti-p").text(), 10);
        const mbtiData = {
          mbtiI,
          mbtiE,
          mbtiS,
          mbtiN,
          mbtiT,
          mbtiF,
          mbtiJ,
          mbtiP,
        };

        // DB 값을 로컬스토리지에 저장
        // localStorage.setItem("mbtiData", JSON.stringify(mbtiData));

        // 모달 창에 데이터 설정
        $("#modalImage1").attr("src", imageSrc);
        $("#modalTitle1").text(cardTitle);
        $("#modalText1").text(cardText);
        $("#modalUserLv").text(userLv);
        $("#modalUserSkills").text(userSkills);
        $("#modalUserMbti").text(userMbti);
        $("#modalUserComment").text(userComment);

        // 모달 창 열기
        $("#modalContainer1").removeClass("hidden");
        updateOctagonRadarChart(mbtiData);
      });

      // Octagon Radar Chart 업데이트 함수
      function updateOctagonRadarChart(mbtiData) {
        console.log(mbtiData, "MBTI 콘솔");
        console.log(octagonRadarChart.data.datasets[0], "MBTI 데이터 갱신 확인 콘솔");
        octagonRadarChart.data.datasets[0].data = [
          mbtiData.mbtiE,
          mbtiData.mbtiI,
          mbtiData.mbtiN,
          mbtiData.mbtiT,
          mbtiData.mbtiJ,
          mbtiData.mbtiP,
          mbtiData.mbtiF,
          mbtiData.mbtiS,
        ];
        octagonRadarChart.update();
      }

      // 모달 닫기 버튼 이벤트
      $("#modalCloseButton1").click(function () {
        // localStorage.clear();
        // location.reload();
        $("#modalContainer1").addClass("hidden");
      });
    </script>

    <!-- 슬라이더 및 모달 관련 스크립트 -->
    <script src="../script/slides.js"></script>
    <script src="../script/modal.js"></script>

    <!-- 모달 컨텐츠 -->
    <div id="modalContainer1" class="hidden">
      <div id="modalContent1">
        <div class="modal-header">
          <h2><span class="close" id="modalCloseButton1">&times;</span></h2>
          <h3 id="signin1">이미지 모달</h3>
        </div>
        <div class="mypostingbox" id="postingbox1">
          <div class="modalcharacterimgChart">
            <img id="modalImage1" alt="Modal Image" style="width: 150px; float: left;" />
            <div style="width: 200px; height: 200px; float: left; align-items: right;"><canvas id="octagonRadarChart"></canvas></div>
          </div>
          <h4 id="modalTitle1"></h4>
          <p class="modalText01" id="modalText1"></p>
          <div id="modalUserMbti"></div>
          <p class="modalText01" id="modalUserLv"></p>
          <p id="modalUserSkills"></p>
          <p class="modalText01" id="modalUserComment"></p>
          <form id="commentFrm">
          <span>
            <h4>응원하기</h4>
              <div class="form-floating">
                <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="응원의 한마디"  aria-describedby="CheeringBtn">
                  <button class="btn btn-warning" type="submit" value="등록" id="CheeringBtn">응원하기</button>
                </form>
                </div>
              </div>
          </span>
          <div class="modalbuttons">
            <button type="button" class="btn btn-outline-danger" id="" style="width: 150px;">삭제</button>
            <button type="button" class="btn btn-danger" id="modalCloseButton1" style="width: 150px">닫기</button>
          </div>
        </div>
      </div>
    </div>
    <script defer src="../script/chat.js">
      
      // 댓글 쓰기 읽기 
      const CheeringBtn = document.querySelector("#commentFrm");
      const list =[];

      function commentBtnHandler(e){
        e.preventDefault();
        console.dir(e.target);
        console.log(e.target[0].value);
        console.log(e.target.elements[0]);
        console.log(e.target.elements[0].value);
        console.log(e.target.elements.content);
        console.log(e.target.elements.content.value);
        console.log(e.target.contant);
        console.log(e.target.contant.value);
      }

      CheeringBtn.addEventListener("submit",commentBtnHandler);
      

    </script>
  </body>
</html>
